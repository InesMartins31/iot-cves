FROM ubuntu:20.04

ARG DEBIAN_FRONTEND=noninteractive

WORKDIR /home

RUN apt-get update && \
    apt-get install -y --no-install-recommends make wget nano libssl-dev build-essential groff-base && \
    rm -rf /tmp/* /var/lib/apt/lists/* /var/tmp/*

RUN wget http://www.nazgul.ch/dev/nostromo-1.9.6.tar.gz && \
    tar xf nostromo-1.9.6.tar.gz && \
    cd nostromo-1.9.6 && \
    make -j $(nproc) && \
    make install && \
    chmod -R a+w /var/nostromo/logs/ && \
    cp /var/nostromo/conf/nhttpd.conf-dist /var/nostromo/conf/nhttpd.conf && \
    sed -i "5 s/www.nazgul.ch/localhost/" /var/nostromo/conf/nhttpd.conf && \
    sed -i "22 s/_nostromo/www-data/" /var/nostromo/conf/nhttpd.conf

EXPOSE 80

CMD nhttpd -d && /bin/bash
