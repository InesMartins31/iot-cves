# CVE-2019-6111

## About

<https://nvd.nist.gov/vuln/detail/CVE-2019-6111>


## PoC / Exploit

* <https://www.exploit-db.com/exploits/46193/> 
* <https://gist.github.com/mehaase/63e45c17bdbbd59e8e68d02ec58f4ca2>


## Environment tested

* Ubuntu 18.04.3 LTS
* OpenSSH 7.6-7.9

## Installation

#### OpenSSL (optional yet recommended)
``` bash
wget --no-check-certificate https://www.openssl.org/source/old/1.0.2/openssl-1.0.2s.tar.gz
gzip -d openssl-1.0.2s.tar.gz && tar xvf openssl-1.0.2s.tar && cd openssl-1.0.2s
./config && make && make test && sudo make install
```

#### OpenSSH
* Start
```bash
bash script.sh
wget --no-check-certificate https://ftp.rnl.tecnico.ulisboa.pt/pub/OpenBSD/OpenSSH/portable/openssh-7.9p1.tar.gz
gzip -d openssh-7.9p1.tar.gz && tar xvf openssh-7.9p1.tar && cd openssh-7.9p1
```

* Configuration with OpenSSL (PATH usually is "/usr/local/ssl/")
```bash
./configure --with-md5-passwords --with-pam --with-selinux --with-privsep-path=/var/lib/sshd/ --sysconfdir=/etc/ssh --with-ssl-dir={PATH}
```
* Configuration without SSL:
```bash
./configure --with-md5-passwords --with-pam --with-selinux --with-privsep-path=/var/lib/sshd/ --sysconfdir=/etc/ssh --without-openssl-header-check
```

* Installation
```bash
make && sudo make install
```
* Check version:
```bash
ssh -V
```
<br/>

SSL usual location:  `/usr/local/ssl/bin/openssl` <br/>
SSH usual location:  `/usr/local/bin/ssh`

## Reproduction
* Terminal 1
```bash
echo "HELLO" >> file.txt 
python3 exploit.py
```
* Terminal 2
```bash
scp -P 2222 {USER}@localhost:file.txt .
ls -a
```
The result of `ls -a` will show the file requested (`file.txt`)  with his content adulterated and another called `exploit.txt`.

## Links
* [OpenSSL versions](https://www.openssl.org/source/) 
* [Tutorial SSL source compilation](https://askubuntu.com/a/463317)
* [OpenSSH old versions](https://ftp.rnl.tecnico.ulisboa.pt/pub/OpenBSD/OpenSSH/portable)
* [Tutorial SSH source compilation](https://www.tecmint.com/install-openssh-server-from-source-in-linux/)
* [Release with patch](https://www.openssh.com/txt/release-8.0)