FROM ubuntu:20.04

ARG DEBIAN_FRONTEND=noninteractive

RUN apt-get update && \
    apt-get install -y wget tar gzip nano build-essential zlib1g-dev libssl-dev libffi-dev python3 python3-pip net-tools \
    libpam0g-dev libselinux1-dev iputils-ping netcat ca-certificates

RUN pip3 install paramiko

RUN mkdir -p /var/lib/sshd && \
    chmod -R 700 /var/lib/sshd/ && \
    chown -R root:sys /var/lib/sshd/ && \
    useradd -r -U -d /var/lib/sshd/ -c "sshd privsep" -s /bin/false sshd

RUN wget -q https://www.openssl.org/source/old/1.0.2/openssl-1.0.2s.tar.gz && \
    gzip -d openssl-1.0.2s.tar.gz && \
    tar xvf openssl-1.0.2s.tar && \
    cd openssl-1.0.2s && \
    ./config && make -j "$(nproc)" && make install

RUN wget -q https://ftp.rnl.tecnico.ulisboa.pt/pub/OpenBSD/OpenSSH/portable/openssh-7.9p1.tar.gz && \
    gzip -d openssh-7.9p1.tar.gz && \
    tar xvf openssh-7.9p1.tar && \
    cd openssh-7.9p1 && \
    ./configure --with-md5-passwords --with-pam --with-selinux --with-privsep-path=/var/lib/sshd/ \
    --sysconfdir=/etc/ssh --with-ssl-dir=/usr/local/ssl && \
    make -j "$(nproc)" && make install

RUN echo "root:qwerty" | chpasswd

RUN sed -i "s/#PermitRootLogin.*/PermitRootLogin yes/1" /etc/ssh/sshd_config

WORKDIR /home

CMD /bin/bash
