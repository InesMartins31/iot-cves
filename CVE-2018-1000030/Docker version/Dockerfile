FROM ubuntu:18.04

ARG USER="ubuntu"
RUN useradd -m "$USER" -s /bin/bash
RUN mkdir -p /home/"$USER"/.ssh
RUN echo "$USER:$USER" | chpasswd

WORKDIR /home/"$USER"
ENV DEBIAN_FRONTEND=noninteractive
RUN apt-get update && apt-get install -y wget git make gcc g++ openssh-server

RUN mkdir -p /var/run/sshd
RUN sed --in-place 's/^\(UsePAM\|UseDNS\)/#\1/' /etc/ssh/sshd_config && echo "" >>/etc/ssh/sshd_config
RUN echo "UsePAM no" >>/etc/ssh/sshd_config && echo "UseDNS no" >>/etc/ssh/sshd_config

RUN wget https://www.python.org/ftp/python/2.7.14/Python-2.7.14.tgz
RUN tar zxf Python-2.7.14.tgz
RUN cd Python-2.7.14 && ./configure && make -j && make install

RUN cd /home/"$USER" && git clone https://github.com/tylepr96/CVE-2018-1000030 && chown -R "$USER":"$USER" /home/"$USER"
EXPOSE 22

CMD ["/usr/sbin/sshd","-D","-p","22"]
