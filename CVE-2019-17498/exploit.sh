#!/bin/bash

read -rp "Server IP: " SERVER_IP

cd /tmp || exit
if [ ! -d libssh2-1.8.2 ]; then
  sudo apt-get update && sudo apt-get install -y git gcc build-essential autoconf automake libtool g++
  wget https://github.com/libssh2/libssh2/releases/download/libssh2-1.8.2/libssh2-1.8.2.tar.gz
  tar zxf libssh2-1.8.2.tar.gz
  cd libssh2-1.8.2 || exit
  sed -i "s/sin.sin_port.*/sin.sin_port = htons(8022);/1" example/ssh2.c
  ./buildconf && ./configure && make -j
fi
if [ -d /tmp/libssh2-1.8.2 ]; then
  /tmp/libssh2-1.8.2/example/ssh2 "$SERVER_IP" guest guest
fi
