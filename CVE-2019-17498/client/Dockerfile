FROM ubuntu:20.04
ARG DEBIAN_FRONTEND=noninteractive
ENV SERVER_IP ""
RUN apt-get update && \
    apt-get install -y --no-install-recommends git gcc build-essential autoconf automake libtool g++ wget tar ca-certificates libssl-dev
ENV PORT 8022
RUN wget https://github.com/libssh2/libssh2/releases/download/libssh2-1.8.2/libssh2-1.8.2.tar.gz && \
    tar zxf libssh2-1.8.2.tar.gz && \
    cd libssh2-1.8.2 && \
    sed -i "s/sin.sin_port.*/sin.sin_port = htons(${PORT});/1" example/ssh2.c && \
    ./buildconf && ./configure && make -j"$(nproc)"
CMD read -rp "Server IP: " SERVER_IP && /libssh2-1.8.2/example/ssh2 ${SERVER_IP} guest guest
