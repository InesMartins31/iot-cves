FROM ubuntu:18.04

ARG DEBIAN_FRONTEND=noninteractive
ARG USER="ubuntu"

RUN apt-get update && \
    apt-get install -y --no-install-recommends wget git make gcc g++ openssh-server ca-certificates && \
    rm -rf /tmp/* /var/lib/apt/lists/* /var/tmp/*

RUN mkdir -p /var/run/sshd && \
    sed --in-place 's/^\(UsePAM\|UseDNS\)/#\1/' /etc/ssh/sshd_config && \
    echo "" >>/etc/ssh/sshd_config && \
    echo "UsePAM no" >>/etc/ssh/sshd_config && \
    echo "UseDNS no" >>/etc/ssh/sshd_config && \
    wget https://www.python.org/ftp/python/2.7.14/Python-2.7.14.tgz && \
    tar zxf Python-2.7.14.tgz && \
    cd Python-2.7.14 && \
    ./configure && make -j$(nproc) && make install && \
    useradd -m "$USER" -s /bin/bash && \
    mkdir -p /home/"$USER"/.ssh && \
    echo "$USER:$USER" | chpasswd && \
    cd /home/"$USER" && \
    git clone https://github.com/tylepr96/CVE-2018-1000030 && \
    chown -R "$USER":"$USER" /home/"$USER"

EXPOSE 22

CMD ["/usr/sbin/sshd","-D","-p","22","-d"]
