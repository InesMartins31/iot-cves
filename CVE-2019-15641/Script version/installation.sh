#!/bin/bash

sudo apt update

# Dependencies
sudo apt-get install -y libnet-ssleay-perl libauthen-pam-perl libio-pty-perl python apt-show-versions libxml-parser-perl
sudo apt-get --fix-broken install -f -y

# Python 2
sudo apt install python-pip -y
pip2 install requests

# Webmin 1.90
wget https://netcologne.dl.sourceforge.net/project/webadmin/webmin/1.900/webmin_1.900_all.deb
sudo dpkg -i webmin_1.900_all.deb
sudo apt --fix-broken install -y

sudo /usr/share/webmin/changepass.pl /etc/webmin root admin
sudo sed --in-place s/passwd_mode=.*/passwd_mode=2/1 /etc/webmin/miniserv.conf

# User for testing
USER="test"
sudo useradd "$USER"
echo "$USER:qwerty" | sudo chpasswd
echo "$USER:x::::::::::::" | sudo tee -a /etc/webmin/miniserv.users
echo "rpc=1" | sudo tee -a /etc/webmin/"$USER".acl

sudo /etc/webmin/restart
