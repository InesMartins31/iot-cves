#!/bin/bash
echo -e "\t\t\tTo execute this script you must be on sudoers\n\n"

read -rp "Insert user with sudo: " USER
if groups "$USER" | grep sudo >/dev/null; then

    read -rp "User to test: " NEW_USER

#    sudo cp /etc/sudoers.bak /etc/sudoers
    sudo cp /etc/sudoers /tmp/
    cd /tmp || exit
    sudo chown "$USER": sudoers
    chmod u+w sudoers
    sed '/^root.*/a '"$NEW_USER"'\tALL=(ALL, !root) ALL' sudoers >temp.txt
    sudo chown root: temp.txt
    sudo chmod 440 temp.txt
    sudo mv temp.txt /etc/sudoers
    rm sudoers

    cd - >/dev/null || exit

    echo "Next step: execute 'su $NEW_USER' and run 'bash exploit-part2.sh'"
fi
