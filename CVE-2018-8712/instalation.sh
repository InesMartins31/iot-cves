#!/bin/bash

sudo apt update

# Dependencies
sudo apt-get install --no-install-recommends -y libnet-ssleay-perl libauthen-pam-perl libio-pty-perl python apt-show-versions &&
  sudo apt-get --fix-broken install -f -y

# Python 2
sudo apt install --no-install-recommends -y python-pip
pip2 install requests

# Webmin 1.880
wget https://netix.dl.sourceforge.net/project/webadmin/webmin/1.880/webmin_1.880_all.deb &&
  sudo dpkg -i webmin_1.880_all.deb &&
  sudo apt --fix-broken install -y

sudo /usr/share/webmin/changepass.pl /etc/webmin root admin
sudo sed -i s/referers_none.*/referers_none=0/1 /etc/webmin/config

USER="test"
echo "$USER:x::::::::::::" | sudo tee -a /etc/webmin/miniserv.users &&
  echo "$USER: syslog" | sudo tee -a /etc/webmin/webmin.acl &&
  # Just to be certain
  echo -e "any=1\nsyslog=1" | sudo tee /etc/webmin/syslog/$USER.acl

sudo /etc/webmin/restart
